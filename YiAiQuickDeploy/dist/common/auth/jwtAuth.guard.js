'use strict';function _0x4bf4(){const _0x590ba7=['extractToken','../../modules/redisCache/redisCache.service','toString','172HWsusZ','moduleRef','62254khkEeO','HttpStatus','function','2AzhCaI','authService','UnauthorizedException','../../modules/auth/auth.service','createTokenFromFingerprint','JWT_SECRET','241115jyczFf','6KQyGLh','split','Bearer','1537860svtqer','9gIDwPA','headers','design:paramtypes','canActivate','checkTokenAuth','validateToken','11ImORQa','11001bkXBnL','object','JwtAuthGuard','metadata','env','redisCacheService','GlobalConfigService','../../modules/globalConfig/globalConfig.service','log','handleRequest','RedisCacheService','fingerprint','636416JCpcbs','__metadata','user','838248PoEJrZ','@nestjs/core','__esModule','getRequest','@nestjs/common','jwt','decorate','ModuleRef','亲爱的用户,请登录后继续操作,我们正在等您的到来！','slice','authorization','688289ccluPG','globalConfigService','HttpException','defineProperty','AuthService','length','UNAUTHORIZED'];_0x4bf4=function(){return _0x590ba7;};return _0x4bf4();}const _0x475325=_0x4711;(function(_0x754cfd,_0x500f02){const _0x8a2f3d=_0x4711,_0x46bc6a=_0x754cfd();while(!![]){try{const _0x42a165=parseInt(_0x8a2f3d(0x1b0))/0x1*(-parseInt(_0x8a2f3d(0x1b3))/0x2)+parseInt(_0x8a2f3d(0x1c5))/0x3*(parseInt(_0x8a2f3d(0x1ae))/0x4)+-parseInt(_0x8a2f3d(0x1b9))/0x5+parseInt(_0x8a2f3d(0x1ba))/0x6*(-parseInt(_0x8a2f3d(0x1a4))/0x7)+parseInt(_0x8a2f3d(0x196))/0x8*(parseInt(_0x8a2f3d(0x1be))/0x9)+parseInt(_0x8a2f3d(0x1bd))/0xa+parseInt(_0x8a2f3d(0x1c4))/0xb*(-parseInt(_0x8a2f3d(0x199))/0xc);if(_0x42a165===_0x500f02)break;else _0x46bc6a['push'](_0x46bc6a['shift']());}catch(_0x19c44a){_0x46bc6a['push'](_0x46bc6a['shift']());}}}(_0x4bf4,0x1b6e9));function _0x4711(_0x3936fa,_0xc925b0){const _0x4bf47f=_0x4bf4();return _0x4711=function(_0x47119c,_0x5de5a0){_0x47119c=_0x47119c-0x191;let _0x334480=_0x4bf47f[_0x47119c];return _0x334480;},_0x4711(_0x3936fa,_0xc925b0);}var __decorate=this&&this['__decorate']||function(_0x360a7c,_0x2c1ec4,_0x4a6c68,_0x2bb302){const _0x13e23b=_0x4711;var _0x318765=arguments[_0x13e23b(0x1a9)],_0x231d6d=_0x318765<0x3?_0x2c1ec4:_0x2bb302===null?_0x2bb302=Object['getOwnPropertyDescriptor'](_0x2c1ec4,_0x4a6c68):_0x2bb302,_0x4e069a;if(typeof Reflect===_0x13e23b(0x1c6)&&typeof Reflect['decorate']==='function')_0x231d6d=Reflect[_0x13e23b(0x19f)](_0x360a7c,_0x2c1ec4,_0x4a6c68,_0x2bb302);else{for(var _0x19517=_0x360a7c[_0x13e23b(0x1a9)]-0x1;_0x19517>=0x0;_0x19517--)if(_0x4e069a=_0x360a7c[_0x19517])_0x231d6d=(_0x318765<0x3?_0x4e069a(_0x231d6d):_0x318765>0x3?_0x4e069a(_0x2c1ec4,_0x4a6c68,_0x231d6d):_0x4e069a(_0x2c1ec4,_0x4a6c68))||_0x231d6d;}return _0x318765>0x3&&_0x231d6d&&Object[_0x13e23b(0x1a7)](_0x2c1ec4,_0x4a6c68,_0x231d6d),_0x231d6d;},__metadata=this&&this[_0x475325(0x197)]||function(_0x176fd1,_0xe9a45e){const _0x164142=_0x475325;if(typeof Reflect==='object'&&typeof Reflect[_0x164142(0x1c8)]===_0x164142(0x1b2))return Reflect[_0x164142(0x1c8)](_0x176fd1,_0xe9a45e);};Object['defineProperty'](exports,_0x475325(0x19b),{'value':!![]}),exports['JwtAuthGuard']=void 0x0;const redisCache_service_1=require(_0x475325(0x1ac)),common_1=require(_0x475325(0x19d)),passport_1=require('@nestjs/passport'),jwt=require('jsonwebtoken'),core_1=require(_0x475325(0x19a)),globalConfig_service_1=require(_0x475325(0x191)),auth_service_1=require(_0x475325(0x1b6));let JwtAuthGuard=class JwtAuthGuard extends(0x0,passport_1['AuthGuard'])(_0x475325(0x19e)){constructor(_0x1a8230,_0x287918,_0x3e39c0,_0x1ca120){const _0x44c087=_0x475325;super(),this[_0x44c087(0x1ca)]=_0x1a8230,this[_0x44c087(0x1af)]=_0x287918,this[_0x44c087(0x1a5)]=_0x3e39c0,this[_0x44c087(0x1b4)]=_0x1ca120;}async[_0x475325(0x1c1)](_0x12472e){const _0xab9ec0=_0x475325;!this[_0xab9ec0(0x1ca)]&&(this[_0xab9ec0(0x1ca)]=this[_0xab9ec0(0x1af)]['get'](redisCache_service_1[_0xab9ec0(0x194)],{'strict':![]}));const _0x382c19=_0x12472e['switchToHttp']()[_0xab9ec0(0x19c)](),_0x101024=_0x382c19[_0xab9ec0(0x1bf)]['x-website-domain'],_0x260ef9=this[_0xab9ec0(0x1ab)](_0x382c19);_0x382c19[_0xab9ec0(0x198)]=this[_0xab9ec0(0x1c3)](_0x260ef9);const _0x32c763=this[_0xab9ec0(0x1a5)]['getNineAiToken']();return await this[_0xab9ec0(0x1ca)][_0xab9ec0(0x1c2)](_0x260ef9,_0x382c19),!![];}['extractToken'](_0x5f4809){const _0xb466dc=_0x475325;if(!_0x5f4809['headers'][_0xb466dc(0x1a3)]){if(_0x5f4809[_0xb466dc(0x1bf)][_0xb466dc(0x195)]){let _0x26de5b=_0x5f4809[_0xb466dc(0x1bf)][_0xb466dc(0x195)];_0x26de5b>0x7fffffff&&(_0x26de5b=_0x26de5b[_0xb466dc(0x1ad)]()[_0xb466dc(0x1a2)](-0x9),_0x26de5b=Number(String(Number(_0x26de5b))));const _0x887281=this['authService'][_0xb466dc(0x1b7)](_0x26de5b);return _0x887281;}return null;}const _0x9ca58a=_0x5f4809[_0xb466dc(0x1bf)][_0xb466dc(0x1a3)][_0xb466dc(0x1bb)]('\x20');if(_0x9ca58a[_0xb466dc(0x1a9)]!==0x2||_0x9ca58a[0x0]!==_0xb466dc(0x1bc))return null;return _0x9ca58a[0x1];}[_0x475325(0x1c3)](_0x299d5a){const _0x4748ac=_0x475325;try{return jwt['verify'](_0x299d5a,process[_0x4748ac(0x1c9)][_0x4748ac(0x1b8)]);}catch(_0x156739){throw new common_1[(_0x4748ac(0x1a6))](_0x4748ac(0x1a1),common_1[_0x4748ac(0x1b1)][_0x4748ac(0x1aa)]);}}[_0x475325(0x193)](_0x2a0f57,_0x419af8,_0x23157a){const _0x42be17=_0x475325;if(_0x2a0f57||!_0x419af8){console[_0x42be17(0x192)]('err:\x20',_0x2a0f57);throw _0x2a0f57||new common_1[(_0x42be17(0x1b5))]();}return _0x419af8;}};JwtAuthGuard=__decorate([(0x0,common_1['Injectable'])(),__metadata(_0x475325(0x1c0),[redisCache_service_1[_0x475325(0x194)],core_1[_0x475325(0x1a0)],globalConfig_service_1[_0x475325(0x1cb)],auth_service_1[_0x475325(0x1a8)]])],JwtAuthGuard),exports[_0x475325(0x1c7)]=JwtAuthGuard;