'use strict';const _0x4460f3=_0x14ba;(function(_0x2e0311,_0x2c5e0b){const _0x2b8324=_0x14ba,_0x2d1b2d=_0x2e0311();while(!![]){try{const _0x2d8efa=-parseInt(_0x2b8324(0xaa))/0x1*(parseInt(_0x2b8324(0xa1))/0x2)+-parseInt(_0x2b8324(0x96))/0x3+-parseInt(_0x2b8324(0xa4))/0x4+parseInt(_0x2b8324(0x99))/0x5+parseInt(_0x2b8324(0x9c))/0x6+-parseInt(_0x2b8324(0xb3))/0x7*(-parseInt(_0x2b8324(0xad))/0x8)+parseInt(_0x2b8324(0xa7))/0x9;if(_0x2d8efa===_0x2c5e0b)break;else _0x2d1b2d['push'](_0x2d1b2d['shift']());}catch(_0x142777){_0x2d1b2d['push'](_0x2d1b2d['shift']());}}}(_0x2a5a,0xe4109));function _0x2a5a(){const _0x5b7aee=['GlobalConfigService','mjTimeoutMs','QueueService','push','metadata','midjourneyService','clean','getOwnPropertyDescriptor','__esModule','design:paramtypes','../userBalance/userBalance.service','UPSCALE','getConfigs','globalConfigService','../midjourney/midjourney.service','onApplicationBootstrap','mjDrawQueue','BAD_REQUEST','InjectQueue','@nestjs/common','HttpException','5468445pnvAqh','MidjourneyService','../globalConfig/globalConfig.service','6737750XvTsAj','active','object','9952038bNQNev','length','assign','MJDRAW','checkLimit','62egxuuk','../../common/utils','addDrawQueue','2391620NxEsjj','userBalanceService','decorate','1803924eovcCv','缺少必要参数！','__decorate','25577ycksdc','__param','function','8mLTcaE','mjDraw','getDrawActionDetail','jobIds','addMjDrawQueue','UserBalanceService','6587707FAuSTP'];_0x2a5a=function(){return _0x5b7aee;};return _0x2a5a();}function _0x14ba(_0x4cd213,_0x35812c){const _0x2a5a46=_0x2a5a();return _0x14ba=function(_0x14ba71,_0x198bdc){_0x14ba71=_0x14ba71-0x8a;let _0x34a093=_0x2a5a46[_0x14ba71];return _0x34a093;},_0x14ba(_0x4cd213,_0x35812c);}var __decorate=this&&this[_0x4460f3(0xa9)]||function(_0x230edc,_0x44cb3c,_0x31be8e,_0x143700){const _0x4991f0=_0x4460f3;var _0x431969=arguments['length'],_0x3863bf=_0x431969<0x3?_0x44cb3c:_0x143700===null?_0x143700=Object[_0x4991f0(0xbb)](_0x44cb3c,_0x31be8e):_0x143700,_0x260f0e;if(typeof Reflect===_0x4991f0(0x9b)&&typeof Reflect['decorate']===_0x4991f0(0xac))_0x3863bf=Reflect[_0x4991f0(0xa6)](_0x230edc,_0x44cb3c,_0x31be8e,_0x143700);else{for(var _0x20fe32=_0x230edc[_0x4991f0(0x9d)]-0x1;_0x20fe32>=0x0;_0x20fe32--)if(_0x260f0e=_0x230edc[_0x20fe32])_0x3863bf=(_0x431969<0x3?_0x260f0e(_0x3863bf):_0x431969>0x3?_0x260f0e(_0x44cb3c,_0x31be8e,_0x3863bf):_0x260f0e(_0x44cb3c,_0x31be8e))||_0x3863bf;}return _0x431969>0x3&&_0x3863bf&&Object['defineProperty'](_0x44cb3c,_0x31be8e,_0x3863bf),_0x3863bf;},__metadata=this&&this['__metadata']||function(_0x539882,_0x479bff){const _0x24366e=_0x4460f3;if(typeof Reflect===_0x24366e(0x9b)&&typeof Reflect[_0x24366e(0xb8)]==='function')return Reflect['metadata'](_0x539882,_0x479bff);},__param=this&&this[_0x4460f3(0xab)]||function(_0x9f0ddd,_0x3034b8){return function(_0x10e7c5,_0x5309bd){_0x3034b8(_0x10e7c5,_0x5309bd,_0x9f0ddd);};};Object['defineProperty'](exports,_0x4460f3(0xbc),{'value':!![]}),exports[_0x4460f3(0xb6)]=void 0x0;const common_1=require(_0x4460f3(0x94)),bull_1=require('@nestjs/bull'),utils_1=require(_0x4460f3(0xa2)),midjourney_service_1=require(_0x4460f3(0x8f)),userBalance_service_1=require(_0x4460f3(0x8b)),globalConfig_service_1=require(_0x4460f3(0x98));let QueueService=class QueueService{constructor(_0x2cf3c1,_0x436f88,_0x49ea9e,_0x5e34a0){const _0x1a8ceb=_0x4460f3;this[_0x1a8ceb(0x91)]=_0x2cf3c1,this[_0x1a8ceb(0xb9)]=_0x436f88,this[_0x1a8ceb(0xa5)]=_0x49ea9e,this['globalConfigService']=_0x5e34a0,this[_0x1a8ceb(0xb0)]=[];}async[_0x4460f3(0x90)](){const _0x2a44ef=_0x4460f3;await this[_0x2a44ef(0x91)][_0x2a44ef(0xba)](0x0,_0x2a44ef(0x9a)),await this[_0x2a44ef(0xb9)]['cleanQueue']();}async[_0x4460f3(0xb1)](_0x5627ba,_0x44929f){const _0x54d383=_0x4460f3,{imgUrl:_0x2711df,orderId:_0x58b0b7,action:_0x1086da,drawId:_0x5e9e58}=_0x5627ba;await this[_0x54d383(0xb9)][_0x54d383(0xa0)](_0x44929f),await this[_0x54d383(0xa5)]['validateBalance'](_0x44929f,_0x54d383(0xae),_0x1086da===_0x54d383(0x8c)?0x1:0x4);if(_0x1086da==='IMAGINE'){const _0x379a7b=''+(0x0,utils_1['createRandomUid'])(),_0x4e6a31=Object['assign'](Object[_0x54d383(0x9e)]({},_0x5627ba),{'userId':_0x44929f['user']['id'],'randomDrawId':_0x379a7b}),_0x208047=await this['midjourneyService'][_0x54d383(0xa3)](_0x4e6a31),_0x3840d2=await this[_0x54d383(0x8e)][_0x54d383(0x8d)](['mjTimeoutMs'])||0x30d40,_0x248581=await this[_0x54d383(0x91)]['add'](_0x54d383(0xae),{'id':_0x208047['id'],'action':_0x1086da,'userId':_0x44929f['user']['id']},{'delay':0x3e8,'timeout':+_0x3840d2});return this[_0x54d383(0xb0)][_0x54d383(0xb7)](_0x248581['id']),!![];}else{const {orderId:_0xe72650,action:_0x426e84,drawId:_0x3db977}=_0x5627ba,_0xabfdd9=await this[_0x54d383(0xb9)][_0x54d383(0xaf)](_0x426e84,_0x3db977,_0xe72650),_0x39dc70=Object['assign'](Object[_0x54d383(0x9e)](Object[_0x54d383(0x9e)]({},_0x5627ba),{'userId':_0x44929f['user']['id']}),_0xabfdd9),_0xe7a620=await this[_0x54d383(0xb9)][_0x54d383(0xa3)](_0x39dc70),_0x1e161b=await this['globalConfigService'][_0x54d383(0x8d)]([_0x54d383(0xb5)])||0x30d40,_0x65667d=await this[_0x54d383(0x91)]['add']('mjDraw',{'id':_0xe7a620['id'],'action':_0x426e84,'userId':_0x44929f['user']['id']},{'delay':0x3e8,'timeout':+_0x1e161b});this['jobIds'][_0x54d383(0xb7)](_0x65667d['id']);return;}if(!_0x5e9e58||!_0x58b0b7)throw new common_1[(_0x54d383(0x95))](_0x54d383(0xa8),common_1['HttpStatus'][_0x54d383(0x92)]);}async['getQueue'](){const _0x19a927=_0x4460f3;return{'jobIds':this[_0x19a927(0xb0)]};}};QueueService=__decorate([__param(0x0,(0x0,bull_1[_0x4460f3(0x93)])(_0x4460f3(0x9f))),__metadata(_0x4460f3(0x8a),[Object,midjourney_service_1[_0x4460f3(0x97)],userBalance_service_1[_0x4460f3(0xb2)],globalConfig_service_1[_0x4460f3(0xb4)]])],QueueService),exports[_0x4460f3(0xb6)]=QueueService;