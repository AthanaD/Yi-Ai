'use strict';const _0x2de3ae=_0x244e;function _0x244e(_0x2e4d0c,_0x373d91){const _0x4f1b07=_0x4f1b();return _0x244e=function(_0x244efd,_0x373bd3){_0x244efd=_0x244efd-0x12e;let _0x15a1ed=_0x4f1b07[_0x244efd];return _0x15a1ed;},_0x244e(_0x2e4d0c,_0x373d91);}(function(_0x263962,_0x22a28e){const _0x335590=_0x244e,_0x35e96e=_0x263962();while(!![]){try{const _0x557f3c=-parseInt(_0x335590(0x13e))/0x1*(-parseInt(_0x335590(0x14f))/0x2)+-parseInt(_0x335590(0x143))/0x3+-parseInt(_0x335590(0x136))/0x4+parseInt(_0x335590(0x154))/0x5+-parseInt(_0x335590(0x157))/0x6+-parseInt(_0x335590(0x146))/0x7+-parseInt(_0x335590(0x148))/0x8*(-parseInt(_0x335590(0x12f))/0x9);if(_0x557f3c===_0x22a28e)break;else _0x35e96e['push'](_0x35e96e['shift']());}catch(_0x2e4c4e){_0x35e96e['push'](_0x35e96e['shift']());}}}(_0x4f1b,0x667a3));Object[_0x2de3ae(0x134)](exports,_0x2de3ae(0x150),{'value':!![]}),exports[_0x2de3ae(0x135)]=exports['compilerStream']=exports[_0x2de3ae(0x130)]=exports[_0x2de3ae(0x137)]=void 0x0;const axios=require(_0x2de3ae(0x155)),jwt=require(_0x2de3ae(0x14e));function generateToken(_0x4a53cf,_0x34c24a=0x3e8*0x3c*0x3c*0x18*0x168){const _0x16aa25=_0x2de3ae,[_0x4bc20c,_0x2e6365]=_0x4a53cf[_0x16aa25(0x142)]('.'),_0x5b571a={'api_key':_0x4bc20c,'exp':Math[_0x16aa25(0x13c)](Date[_0x16aa25(0x141)]())+_0x34c24a*0x3e8,'timestamp':Math[_0x16aa25(0x13c)](Date[_0x16aa25(0x141)]())};return jwt[_0x16aa25(0x149)](_0x5b571a,_0x2e6365,{'algorithm':_0x16aa25(0x147),'header':{'alg':'HS256','sign_type':_0x16aa25(0x13d)}});}exports['generateToken']=generateToken;function compilerMetaJsonStr(_0x21cbbb){const _0x234e29=_0x2de3ae;let _0x54a2e5={};try{_0x54a2e5=JSON['parse'](_0x21cbbb);}catch(_0x12f523){_0x54a2e5={'usage':{'completion_tokens':0x31,'prompt_tokens':0x14d,'total_tokens':0x18f}},console['error'](_0x234e29(0x13f),_0x21cbbb);}return _0x54a2e5;}exports['compilerMetaJsonStr']=compilerMetaJsonStr;function compilerStream(_0x17793d){const _0x30aa72=_0x2de3ae;var _0x2f8146;if(_0x17793d[_0x30aa72(0x138)]===0x3)return{'event':_0x17793d[0x0][_0x30aa72(0x140)]('event:',''),'id':_0x17793d[0x1][_0x30aa72(0x140)]('id:',''),'is_end':![],'result':_0x17793d[0x2][_0x30aa72(0x140)]('data:','')[_0x30aa72(0x13b)]()};if(_0x17793d[_0x30aa72(0x138)]===0x4)return{'event':_0x17793d[0x0][_0x30aa72(0x140)](_0x30aa72(0x145),''),'id':_0x17793d[0x1]['replace'](_0x30aa72(0x139),''),'result':_0x17793d[0x2]['replace'](_0x30aa72(0x153),'')[_0x30aa72(0x13b)](),'is_end':!![],'usage':(_0x2f8146=compilerMetaJsonStr(_0x17793d[0x3][_0x30aa72(0x140)]('meta:','')))===null||_0x2f8146===void 0x0?void 0x0:_0x2f8146[_0x30aa72(0x14b)]};}exports[_0x2de3ae(0x156)]=compilerStream;async function sendMessageFromZhipu(_0x843288,{onProgress:_0x1290f,key:_0x5bead7,model:_0x297724,temperature:temperature=0.95}){const _0x15d664=await generateToken(_0x5bead7);return new Promise((_0x15ae2,_0x2e9cab)=>{const _0xfc29c2=_0x244e,_0x33c26a=_0xfc29c2(0x131)+_0x297724+_0xfc29c2(0x13a),_0x17bd40={'method':'POST','url':_0x33c26a,'responseType':_0xfc29c2(0x144),'headers':{'Content-Type':'application/json','Authorization':_0x15d664},'data':{'prompt':_0x843288,'temperature':temperature}};axios(_0x17bd40)[_0xfc29c2(0x132)](_0x3425e2=>{const _0x5e2e3e=_0xfc29c2,_0x3b39d3=_0x3425e2['data'];let _0x513a2d,_0x1e63d3='';_0x3b39d3['on']('data',_0x435ed3=>{const _0x5d6f8a=_0x244e,_0x454654=_0x435ed3[_0x5d6f8a(0x14d)]()[_0x5d6f8a(0x142)]('\x0a')[_0x5d6f8a(0x152)](_0x2c2199=>_0x2c2199[_0x5d6f8a(0x13b)]()!==''),_0x11bbed=compilerStream(_0x454654);if(!_0x11bbed)return;const {id:_0x3cf25c,result:_0x133cd2,is_end:_0xf2e29d}=_0x11bbed;_0x133cd2&&(_0x1e63d3+=_0x133cd2[_0x5d6f8a(0x13b)]()),_0xf2e29d&&(_0x11bbed[_0x5d6f8a(0x12e)]=![],_0x513a2d=_0x11bbed,_0x513a2d[_0x5d6f8a(0x14a)]=_0x1e63d3),_0x1290f(_0x11bbed);}),_0x3b39d3['on'](_0x5e2e3e(0x14c),()=>{_0x15ae2(_0x513a2d),_0x1e63d3='';});})[_0xfc29c2(0x151)](_0x4631be=>{const _0x128e14=_0xfc29c2;console[_0x128e14(0x133)]('error:\x20',_0x4631be);});});}function _0x4f1b(){const _0x3d44d8=['860373iDXoDc','compilerMetaJsonStr','https://open.bigmodel.cn/api/paas/v3/model-api/','then','log','defineProperty','sendMessageFromZhipu','798144DaCMhY','generateToken','length','id:','/sse-invoke','trim','round','SIGN','1fthYDY','json\x20parse\x20error\x20from\x20zhipu!','replace','now','split','190002OPgGxi','stream','event:','4085109HRdlTg','HS256','64AoOHDo','sign','text','usage','end','toString','jsonwebtoken','908122qBoISW','__esModule','catch','filter','data:','2598910ScEWbb','axios','compilerStream','2834490rHLtmI','is_end'];_0x4f1b=function(){return _0x3d44d8;};return _0x4f1b();}exports[_0x2de3ae(0x135)]=sendMessageFromZhipu;