'use strict';const _0x253d1a=_0x2df7;(function(_0x4b2755,_0x118b6c){const _0x2c8773=_0x2df7,_0x33d301=_0x4b2755();while(!![]){try{const _0x315468=parseInt(_0x2c8773(0x139))/0x1*(parseInt(_0x2c8773(0x113))/0x2)+-parseInt(_0x2c8773(0x106))/0x3+parseInt(_0x2c8773(0x11f))/0x4*(-parseInt(_0x2c8773(0x11a))/0x5)+-parseInt(_0x2c8773(0x136))/0x6+-parseInt(_0x2c8773(0x10b))/0x7*(-parseInt(_0x2c8773(0x114))/0x8)+parseInt(_0x2c8773(0x122))/0x9*(parseInt(_0x2c8773(0xff))/0xa)+-parseInt(_0x2c8773(0x12b))/0xb*(-parseInt(_0x2c8773(0x12f))/0xc);if(_0x315468===_0x118b6c)break;else _0x33d301['push'](_0x33d301['shift']());}catch(_0x3f028c){_0x33d301['push'](_0x33d301['shift']());}}}(_0x367e,0x48cf6));Object[_0x253d1a(0x12c)](exports,_0x253d1a(0x104),{'value':!![]}),exports['NineStore']=void 0x0;const uuid_1=require(_0x253d1a(0x12a)),tiktoken_1=require(_0x253d1a(0x110)),tokenizer=(0x0,tiktoken_1[_0x253d1a(0x123)])('cl100k_base');class NineStore{constructor(_0x10862e){const _0x48cbf5=_0x253d1a,{store:_0x1ec94d,namespace:_0x467b1b,expires:_0x5e4789}=this[_0x48cbf5(0x11e)](_0x10862e);this[_0x48cbf5(0x119)]=_0x1ec94d,this[_0x48cbf5(0x133)]=_0x467b1b,this[_0x48cbf5(0x10d)]=_0x5e4789;}[_0x253d1a(0x11e)](_0x37e04c){const _0x5e80c1=_0x253d1a,{store:_0x566d94,expires:expires=0x3e8*0x3c*0x3c*0x18*0x3,namespace:namespace=_0x5e80c1(0x10e)}=_0x37e04c;return{'store':_0x566d94,'namespace':namespace,'expires':expires};}[_0x253d1a(0x120)](_0x11a1be){const _0x14b16b=_0x253d1a;return this['namespace']?this[_0x14b16b(0x133)]+'-'+_0x11a1be:_0x11a1be;}async['getData'](_0x165091){const _0x29946f=_0x253d1a,_0x25e965=await this[_0x29946f(0x119)][_0x29946f(0x137)](_0x165091);return _0x25e965;}async[_0x253d1a(0x111)](_0x374ab8,_0xb79b2b=this[_0x253d1a(0x10d)]){const _0x524ef6=_0x253d1a;await this[_0x524ef6(0x119)][_0x524ef6(0x125)](_0x374ab8['id'],_0x374ab8,_0xb79b2b);}async[_0x253d1a(0x12d)](_0x4706b9,_0x7d71a2){const _0x2b8360=_0x253d1a;let {maxRounds:_0x1b3c21,maxModelToken:_0x408855,maxResponseTokens:_0x4d2ffb,systemMessage:systemMessage='',name:_0x160879,imageUrl:_0x296baf,model:_0x27367d,activeModel:_0x44a4b6}=_0x7d71a2,{parentMessageId:_0x1a0c7b}=_0x7d71a2,_0x305cd3=[],_0x65434b=0x0;if(systemMessage){const _0x1edf60=['gemini-pro',_0x2b8360(0x103),'hunyuan'],_0x438762=_0x44a4b6&&_0x1edf60[_0x2b8360(0x107)](_0x26925c=>_0x44a4b6[_0x2b8360(0x126)](_0x26925c));_0x438762?(_0x305cd3[_0x2b8360(0x118)]({'role':_0x2b8360(0x130),'content':systemMessage,'name':_0x160879}),_0x305cd3[_0x2b8360(0x118)]({'role':_0x2b8360(0xfe),'content':'好的','name':_0x160879})):_0x305cd3[_0x2b8360(0x118)]({'role':_0x2b8360(0x115),'content':systemMessage,'name':_0x160879});}const _0x35b5cd=_0x305cd3['length'];let _0xb77965=0x0;if(_0x44a4b6===_0x2b8360(0x10f)&&_0x296baf){const _0x4dfdab=[{'type':_0x2b8360(0x109),'text':_0x4706b9},{'type':_0x2b8360(0x108),'image_url':{'url':_0x296baf}}];_0x305cd3[_0x2b8360(0x118)]({'role':'user','content':_0x4dfdab,'name':_0x160879});}else _0x27367d===_0x2b8360(0x131)&&_0x296baf&&(_0x4706b9=_0x296baf+'\x0a'+_0x4706b9),_0x305cd3[_0x2b8360(0x118)]({'role':'user','content':_0x4706b9,'name':_0x160879});let _0x22e2ad=_0x305cd3;do{if(!_0x1a0c7b)break;const _0x42683e=await this[_0x2b8360(0x11c)](_0x1a0c7b);if(!_0x42683e)break;const {text:_0x4f00ff,name:_0x40b4e1,role:_0x2c8dbb,imageUrl:_0x26494a}=_0x42683e;let _0x1ab0b5=_0x4f00ff;_0x26494a&&(_0x44a4b6===_0x2b8360(0x10f)&&(_0x1ab0b5=[{'type':_0x2b8360(0x109),'text':_0x4f00ff},{'type':'image_url','image_url':{'url':_0x26494a}}]));_0x22e2ad=_0x22e2ad['slice'](0x0,_0x35b5cd)[_0x2b8360(0x10a)]([{'role':_0x2c8dbb,'content':_0x1ab0b5,'name':_0x40b4e1},..._0x22e2ad[_0x2b8360(0x102)](_0x35b5cd)]),_0xb77965++;if(_0x1b3c21&&_0xb77965>=_0x1b3c21)break;if(_0x408855&&_0x4d2ffb){const _0x3f8812=_0x408855-_0x4d2ffb;_0x65434b=await this[_0x2b8360(0x138)](_0x22e2ad);const _0x459e14=_0x65434b+0xc8<=_0x3f8812;!_0x459e14&&(_0x22e2ad=this[_0x2b8360(0x11d)](_0x22e2ad,_0x3f8812,systemMessage));}_0x1a0c7b=_0x42683e[_0x2b8360(0x101)];}while(!![]);const _0x38cf9b=Math[_0x2b8360(0x128)](0x1,Math[_0x2b8360(0x112)](_0x408855-_0x65434b,_0x4d2ffb));return console[_0x2b8360(0x105)](_0x2b8360(0x11b),_0x22e2ad[_0x2b8360(0x100)],_0x65434b),{'context':_0x22e2ad,'round':_0x22e2ad['length'],'historyToken':_0x65434b};}['_getTokenCount'](_0x321708){const _0xff1b5e=_0x253d1a;let _0x292bb5=_0x321708[_0xff1b5e(0x12e)]((_0x9fcadc,_0x13853b)=>{const _0x3a11f9=_0xff1b5e;if(Array[_0x3a11f9(0x10c)](_0x13853b[_0x3a11f9(0x134)])){const _0x22f1b1=_0x13853b['content'][_0x3a11f9(0x129)](_0x3deeb8=>_0x3deeb8[_0x3a11f9(0x135)]===_0x3a11f9(0x109))[_0x3a11f9(0x121)](_0x57db7b=>_0x57db7b['text'])[_0x3a11f9(0x116)]('\x20');return _0x9fcadc+_0x22f1b1;}else return _0x9fcadc+(_0x13853b[_0x3a11f9(0x134)]||'');},'');return _0x292bb5=_0x292bb5[_0xff1b5e(0x124)](/<\|endoftext\|>/g,''),tokenizer[_0xff1b5e(0x117)](_0x292bb5)[_0xff1b5e(0x100)];}[_0x253d1a(0x11d)](_0x2dc329,_0x42c717,_0x118611){const _0x42a596=_0x253d1a,_0x27dcc2=this[_0x42a596(0x138)](_0x2dc329);if(_0x27dcc2<=_0x42c717)return _0x2dc329;return _0x2dc329['splice'](_0x118611?0x1:0x0,0x1),this[_0x42a596(0x11d)](_0x2dc329,_0x42c717,_0x118611);}[_0x253d1a(0x127)](){return(0x0,uuid_1['v4'])();}}function _0x2df7(_0x105785,_0x5d2af3){const _0x367ee0=_0x367e();return _0x2df7=function(_0x2df737,_0x2d109d){_0x2df737=_0x2df737-0xfe;let _0x5811c1=_0x367ee0[_0x2df737];return _0x5811c1;},_0x2df7(_0x105785,_0x5d2af3);}function _0x367e(){const _0x48a487=['some','image_url','text','concat','3513965STFuRz','isArray','expires','chat','gpt-4-vision-preview','@dqbd/tiktoken','setData','min','80FnEOxE','8PoaLfL','system','join','encode','push','store','15cBCfHD','本次携带上下文的长度','getData','_recursivePruning','formatOptions','477580sggEHZ','generateKey','map','4311VvpLkl','get_encoding','replace','set','includes','getUuid','max','filter','uuid','429fdMTMq','defineProperty','buildMessageFromParentMessageId','reduce','226164zoUhHT','user','gpt-4-all','NineStore','namespace','content','type','1429548BqaXdB','get','_getTokenCount','2029zcTNqr','assistant','1850NZKNEB','length','parentMessageId','slice','ERNIE','__esModule','log','1536390gTawjS'];_0x367e=function(){return _0x48a487;};return _0x367e();}exports[_0x253d1a(0x132)]=NineStore;