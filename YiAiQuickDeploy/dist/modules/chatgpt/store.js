'use strict';const _0x50f50f=_0x3b5e;(function(_0x24b475,_0x2db791){const _0x23f80b=_0x3b5e,_0x5713a5=_0x24b475();while(!![]){try{const _0x2b5bb1=-parseInt(_0x23f80b(0x131))/0x1*(parseInt(_0x23f80b(0x13f))/0x2)+parseInt(_0x23f80b(0x136))/0x3+parseInt(_0x23f80b(0x146))/0x4+-parseInt(_0x23f80b(0x13d))/0x5*(-parseInt(_0x23f80b(0x14a))/0x6)+-parseInt(_0x23f80b(0x11d))/0x7+parseInt(_0x23f80b(0x11c))/0x8*(-parseInt(_0x23f80b(0x13c))/0x9)+parseInt(_0x23f80b(0x11a))/0xa;if(_0x2b5bb1===_0x2db791)break;else _0x5713a5['push'](_0x5713a5['shift']());}catch(_0x1d8518){_0x5713a5['push'](_0x5713a5['shift']());}}}(_0x35ec,0x9a2d4));Object[_0x50f50f(0x126)](exports,_0x50f50f(0x145),{'value':!![]}),exports['NineStore']=void 0x0;function _0x3b5e(_0xcfa25a,_0x25c113){const _0x35ec88=_0x35ec();return _0x3b5e=function(_0x3b5e43,_0x46225b){_0x3b5e43=_0x3b5e43-0x118;let _0x4db7c7=_0x35ec88[_0x3b5e43];return _0x4db7c7;},_0x3b5e(_0xcfa25a,_0x25c113);}function _0x35ec(){const _0x4931c0=['6yTocxC','assistant','setData','11309950rkjWkU','some','3006344KksJtP','1803375MYDQYQ','user','length','image_url','namespace','uuid','text','splice','get','defineProperty','min','get_encoding','system','cl100k_base','@dqbd/tiktoken','_getTokenCount','getData','encode','gpt-4-vision-preview','chat','13rVspqe','expires','gemini-pro','content','store','589461mZvpFR','isArray','includes','formatOptions','本次携带上下文的长度','push','18uUJXnX','5800010cvcNPy','slice','165182htvQKJ','filter','set','_recursivePruning','reduce','log','__esModule','907672ghRKvm','replace','max','ERNIE'];_0x35ec=function(){return _0x4931c0;};return _0x35ec();}const uuid_1=require(_0x50f50f(0x122)),tiktoken_1=require(_0x50f50f(0x12b)),tokenizer=(0x0,tiktoken_1[_0x50f50f(0x128)])(_0x50f50f(0x12a));class NineStore{constructor(_0x2ffb68){const _0x4a90d4=_0x50f50f,{store:_0x169238,namespace:_0x2b9abc,expires:_0x17f6b4}=this['formatOptions'](_0x2ffb68);this[_0x4a90d4(0x135)]=_0x169238,this['namespace']=_0x2b9abc,this['expires']=_0x17f6b4;}[_0x50f50f(0x139)](_0x3534a6){const _0x59d76d=_0x50f50f,{store:_0xf07ec8,expires:expires=0x3e8*0x3c*0x3c*0x18*0x3,namespace:namespace=_0x59d76d(0x130)}=_0x3534a6;return{'store':_0xf07ec8,'namespace':namespace,'expires':expires};}['generateKey'](_0xa90b9d){const _0x291b58=_0x50f50f;return this[_0x291b58(0x121)]?this[_0x291b58(0x121)]+'-'+_0xa90b9d:_0xa90b9d;}async['getData'](_0x3d475f){const _0x1b1c5b=_0x50f50f,_0x1e2d60=await this[_0x1b1c5b(0x135)][_0x1b1c5b(0x125)](_0x3d475f);return _0x1e2d60;}async[_0x50f50f(0x119)](_0x41a7e5,_0x5eecdf=this[_0x50f50f(0x132)]){const _0x3a7b2b=_0x50f50f;await this[_0x3a7b2b(0x135)][_0x3a7b2b(0x141)](_0x41a7e5['id'],_0x41a7e5,_0x5eecdf);}async['buildMessageFromParentMessageId'](_0x544efd,_0xc61936){const _0x339840=_0x50f50f;let {maxRounds:_0x2e9366,maxModelToken:_0x17c8d5,maxResponseTokens:_0x504ead,systemMessage:systemMessage='',name:_0xcb86e3,imageUrl:_0x51152,model:_0x5cd175,activeModel:_0xe353f7}=_0xc61936,{parentMessageId:_0x7409c}=_0xc61936,_0x4fc481=[],_0x52c93c=0x0;if(systemMessage){const _0x3b0344=[_0x339840(0x133),_0x339840(0x149),'hunyuan'],_0x323d92=_0xe353f7&&_0x3b0344[_0x339840(0x11b)](_0x19a6d4=>_0xe353f7[_0x339840(0x138)](_0x19a6d4));_0x323d92?(_0x4fc481['push']({'role':_0x339840(0x11e),'content':systemMessage,'name':_0xcb86e3}),_0x4fc481[_0x339840(0x13b)]({'role':_0x339840(0x118),'content':'好的','name':_0xcb86e3})):_0x4fc481[_0x339840(0x13b)]({'role':_0x339840(0x129),'content':systemMessage,'name':_0xcb86e3});}const _0x30442b=_0x4fc481[_0x339840(0x11f)];let _0x145497=0x0;if(_0xe353f7===_0x339840(0x12f)&&_0x51152){const _0x4cd4ff=[{'type':_0x339840(0x123),'text':_0x544efd},{'type':_0x339840(0x120),'image_url':{'url':_0x51152}}];_0x4fc481[_0x339840(0x13b)]({'role':'user','content':_0x4cd4ff,'name':_0xcb86e3});}else _0x5cd175==='gpt-4-all'&&_0x51152&&(_0x544efd=_0x51152+'\x0a'+_0x544efd),_0x4fc481['push']({'role':_0x339840(0x11e),'content':_0x544efd,'name':_0xcb86e3});let _0x544a90=_0x4fc481;do{if(!_0x7409c)break;const _0x399558=await this[_0x339840(0x12d)](_0x7409c);if(!_0x399558)break;const {text:_0x454810,name:_0x3dd4b1,role:_0x359aa8,imageUrl:_0xd8a857}=_0x399558;let _0x16c543=_0x454810;_0xd8a857&&(_0xe353f7===_0x339840(0x12f)&&(_0x16c543=[{'type':_0x339840(0x123),'text':_0x454810},{'type':_0x339840(0x120),'image_url':{'url':_0xd8a857}}]));_0x544a90=_0x544a90['slice'](0x0,_0x30442b)['concat']([{'role':_0x359aa8,'content':_0x16c543,'name':_0x3dd4b1},..._0x544a90[_0x339840(0x13e)](_0x30442b)]),_0x145497++;if(_0x2e9366&&_0x145497>=_0x2e9366)break;if(_0x17c8d5&&_0x504ead){const _0x57fdef=_0x17c8d5-_0x504ead;_0x52c93c=await this[_0x339840(0x12c)](_0x544a90);const _0x51d7af=_0x52c93c+0xc8<=_0x57fdef;!_0x51d7af&&(_0x544a90=this['_recursivePruning'](_0x544a90,_0x57fdef,systemMessage));}_0x7409c=_0x399558['parentMessageId'];}while(!![]);const _0x1168a0=Math[_0x339840(0x148)](0x1,Math[_0x339840(0x127)](_0x17c8d5-_0x52c93c,_0x504ead));return console[_0x339840(0x144)](_0x339840(0x13a),_0x544a90[_0x339840(0x11f)],_0x52c93c),{'context':_0x544a90,'round':_0x544a90['length'],'historyToken':_0x52c93c};}['_getTokenCount'](_0x4f1d9a){const _0x45ebf7=_0x50f50f;let _0x21190f=_0x4f1d9a[_0x45ebf7(0x143)]((_0x5d4d09,_0x53168d)=>{const _0x2bce37=_0x45ebf7;if(Array[_0x2bce37(0x137)](_0x53168d[_0x2bce37(0x134)])){const _0x224aab=_0x53168d[_0x2bce37(0x134)][_0x2bce37(0x140)](_0x13709f=>_0x13709f['type']===_0x2bce37(0x123))['map'](_0x4dc7bc=>_0x4dc7bc[_0x2bce37(0x123)])['join']('\x20');return _0x5d4d09+_0x224aab;}else return _0x5d4d09+(_0x53168d['content']||'');},'');return _0x21190f=_0x21190f[_0x45ebf7(0x147)](/<\|endoftext\|>/g,''),tokenizer[_0x45ebf7(0x12e)](_0x21190f)[_0x45ebf7(0x11f)];}[_0x50f50f(0x142)](_0x305da1,_0x3158e1,_0x188e15){const _0x3a1ba8=_0x50f50f,_0x1a73f8=this[_0x3a1ba8(0x12c)](_0x305da1);if(_0x1a73f8<=_0x3158e1)return _0x305da1;return _0x305da1[_0x3a1ba8(0x124)](_0x188e15?0x1:0x0,0x1),this[_0x3a1ba8(0x142)](_0x305da1,_0x3158e1,_0x188e15);}['getUuid'](){return(0x0,uuid_1['v4'])();}}exports['NineStore']=NineStore;