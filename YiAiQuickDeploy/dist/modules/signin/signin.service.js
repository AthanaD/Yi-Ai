'use strict';const _0x4bbbee=_0x10a7;(function(_0x1d4fc7,_0x1c2966){const _0x53b0ef=_0x10a7,_0x3281b2=_0x1d4fc7();while(!![]){try{const _0x2906b4=parseInt(_0x53b0ef(0x1ec))/0x1*(parseInt(_0x53b0ef(0x1c8))/0x2)+parseInt(_0x53b0ef(0x1bf))/0x3+parseInt(_0x53b0ef(0x1c1))/0x4*(parseInt(_0x53b0ef(0x1cc))/0x5)+-parseInt(_0x53b0ef(0x1ab))/0x6*(-parseInt(_0x53b0ef(0x1c6))/0x7)+-parseInt(_0x53b0ef(0x1b8))/0x8+parseInt(_0x53b0ef(0x1d3))/0x9+parseInt(_0x53b0ef(0x1ae))/0xa*(-parseInt(_0x53b0ef(0x1be))/0xb);if(_0x2906b4===_0x1c2966)break;else _0x3281b2['push'](_0x3281b2['shift']());}catch(_0x1bddce){_0x3281b2['push'](_0x3281b2['shift']());}}}(_0x3a3c,0xa0075));var __decorate=this&&this['__decorate']||function(_0x519434,_0xbf347b,_0x11a87b,_0x3042a6){const _0xb22290=_0x10a7;var _0x1e7c65=arguments['length'],_0x378c88=_0x1e7c65<0x3?_0xbf347b:_0x3042a6===null?_0x3042a6=Object[_0xb22290(0x1a9)](_0xbf347b,_0x11a87b):_0x3042a6,_0x4c7747;if(typeof Reflect===_0xb22290(0x1c3)&&typeof Reflect[_0xb22290(0x1f2)]==='function')_0x378c88=Reflect[_0xb22290(0x1f2)](_0x519434,_0xbf347b,_0x11a87b,_0x3042a6);else{for(var _0x5055a6=_0x519434[_0xb22290(0x1aa)]-0x1;_0x5055a6>=0x0;_0x5055a6--)if(_0x4c7747=_0x519434[_0x5055a6])_0x378c88=(_0x1e7c65<0x3?_0x4c7747(_0x378c88):_0x1e7c65>0x3?_0x4c7747(_0xbf347b,_0x11a87b,_0x378c88):_0x4c7747(_0xbf347b,_0x11a87b))||_0x378c88;}return _0x1e7c65>0x3&&_0x378c88&&Object['defineProperty'](_0xbf347b,_0x11a87b,_0x378c88),_0x378c88;},__metadata=this&&this[_0x4bbbee(0x1ce)]||function(_0x2ac9bd,_0x38df5a){const _0x45669b=_0x4bbbee;if(typeof Reflect==='object'&&typeof Reflect[_0x45669b(0x1d6)]===_0x45669b(0x1ee))return Reflect['metadata'](_0x2ac9bd,_0x38df5a);},__param=this&&this[_0x4bbbee(0x1b2)]||function(_0x2edbe7,_0x58687e){return function(_0x5dac76,_0xc494d0){_0x58687e(_0x5dac76,_0xc494d0,_0x2edbe7);};};function _0x10a7(_0x43cd4f,_0x5371b8){const _0x3a3c7e=_0x3a3c();return _0x10a7=function(_0x10a7ae,_0x4431b5){_0x10a7ae=_0x10a7ae-0x1a6;let _0x56b69a=_0x3a3c7e[_0x10a7ae];return _0x56b69a;},_0x10a7(_0x43cd4f,_0x5371b8);}Object[_0x4bbbee(0x1f1)](exports,_0x4bbbee(0x1af),{'value':!![]}),exports[_0x4bbbee(0x1c2)]=void 0x0;const globalConfig_service_1=require(_0x4bbbee(0x1d1)),userBalance_service_1=require(_0x4bbbee(0x1a8)),common_1=require(_0x4bbbee(0x1ad)),signIn_entity_1=require(_0x4bbbee(0x1ef)),typeorm_1=require(_0x4bbbee(0x1f0)),typeorm_2=require(_0x4bbbee(0x1e2)),date_1=require(_0x4bbbee(0x1b1)),user_entity_1=require('../user/user.entity'),balance_constant_1=require(_0x4bbbee(0x1cf));function _0x3a3c(){const _0x4c0cfe=['object','debug','globalConfigService','4944177CmsmCW','Logger','1941298ozIuPX','userBalanceService','HttpException','RechargeType','1275765EVpBLY','user','__metadata','../../common/constants/balance.constant','error:\x20','../globalConfig/globalConfig.service','HttpStatus','4436010oBopSM','YYYY-MM-DD','Repository','metadata','design:paramtypes','push','signinEntity','signin.signInDate\x20as\x20signInDate,\x20signin.isSigned\x20as\x20isSigned','signin.signInTime\x20>=\x20:firstDay','获取签到数据失败！','userEntity','getDate','getSignatureGiftConfig','andWhere','signin','typeorm','default','subtract','signin.signInTime\x20<=\x20:lastDay','month','UserEntity','endOf','UserBalanceService','format','find','1NfgmoW','signInDate','function','./signIn.entity','@nestjs/typeorm','defineProperty','decorate','isSigned','BAD_REQUEST','Sign\x20in\x20successful.','sign','../userBalance/userBalance.service','getOwnPropertyDescriptor','length','6qqoiSF','今日已签到、改天再来吧!.','@nestjs/common','15659090PEZczu','__esModule','YYYY-MM-DD\x20HH:mm:ss','../../common/utils/date','__param','update','day','createQueryBuilder','SigninEntity','log','8296496VHjKYs','getRawMany','昨天没签到、今天重置天数！','GlobalConfigService','select','findOne','11EtNacd','203958xGMEkj','昨天签到了、今天是连续签到！','16xJGEtr','SigninService'];_0x3a3c=function(){return _0x4c0cfe;};return _0x3a3c();}let SigninService=class SigninService{constructor(_0x2f9fe8,_0x96087a,_0x49466b,_0x45fc6e){const _0x263ef8=_0x4bbbee;this[_0x263ef8(0x1d9)]=_0x2f9fe8,this[_0x263ef8(0x1dd)]=_0x96087a,this[_0x263ef8(0x1c9)]=_0x49466b,this[_0x263ef8(0x1c5)]=_0x45fc6e;}async[_0x4bbbee(0x1a7)](_0x46c000){const _0x1d6338=_0x4bbbee,{id:_0x1a270e}=_0x46c000[_0x1d6338(0x1cd)],_0x3fbde0=(0x0,date_1[_0x1d6338(0x1e3)])(new Date())[_0x1d6338(0x1ea)](_0x1d6338(0x1d4)),_0x3e6662=await this[_0x1d6338(0x1d9)]['findOne']({'where':{'userId':_0x1a270e,'signInDate':_0x3fbde0}});if(_0x3e6662)throw new common_1[(_0x1d6338(0x1ca))](_0x1d6338(0x1ac),common_1[_0x1d6338(0x1d2)]['BAD_REQUEST']);const {model3Count:_0xba6872,model4Count:_0x480908,drawMjCount:_0x163912}=await this[_0x1d6338(0x1c5)][_0x1d6338(0x1df)]();await this[_0x1d6338(0x1d9)]['save']({'userId':_0x1a270e,'signInTime':new Date(),'signInDate':_0x3fbde0,'isSigned':!![]}),await this[_0x1d6338(0x1c9)]['addBalanceToUser'](_0x1a270e,{'model3Count':_0xba6872,'model4Count':_0x480908,'drawMjCount':_0x163912}),await this[_0x1d6338(0x1c9)]['saveRecordRechargeLog']({'userId':_0x1a270e,'rechargeType':balance_constant_1[_0x1d6338(0x1cb)]['SIGN_IN'],'model3Count':_0xba6872,'model4Count':_0x480908,'drawMjCount':_0x163912});const _0x971f21=(0x0,date_1['default'])(new Date())[_0x1d6338(0x1e4)](0x1,_0x1d6338(0x1b4))['format'](_0x1d6338(0x1d4)),_0x5bdc7e=await this[_0x1d6338(0x1d9)][_0x1d6338(0x1bd)]({'where':{'userId':_0x1a270e,'signInDate':_0x971f21}});if(_0x5bdc7e){common_1[_0x1d6338(0x1c7)][_0x1d6338(0x1c4)]('用户'+_0x1a270e+_0x1d6338(0x1c0),_0x1d6338(0x1c2));const _0xdd1bd8=await this['userEntity'][_0x1d6338(0x1bd)]({'where':{'id':_0x1a270e}});if(!_0xdd1bd8)throw new common_1['HttpException']('用户不存在',common_1[_0x1d6338(0x1d2)][_0x1d6338(0x1f4)]);const {consecutiveDays:consecutiveDays=0x0}=_0xdd1bd8;await this[_0x1d6338(0x1dd)][_0x1d6338(0x1b3)]({'id':_0x1a270e},{'consecutiveDays':consecutiveDays+0x1});}else common_1[_0x1d6338(0x1c7)][_0x1d6338(0x1c4)]('用户'+_0x1a270e+_0x1d6338(0x1ba),'SigninService'),await this[_0x1d6338(0x1dd)]['update']({'id':_0x1a270e},{'consecutiveDays':0x1});return _0x1d6338(0x1a6);}async['getSigninLog'](_0x2c4347){const _0x52168e=_0x4bbbee;try{const {id:_0x22deee}=_0x2c4347[_0x52168e(0x1cd)],_0x34d37a=(0x0,date_1[_0x52168e(0x1e3)])()['startOf']('month')[_0x52168e(0x1ea)]('YYYY-MM-DD\x20HH:mm:ss'),_0x2515e7=(0x0,date_1[_0x52168e(0x1e3)])()[_0x52168e(0x1e8)](_0x52168e(0x1e6))[_0x52168e(0x1ea)](_0x52168e(0x1b0)),_0x2a5139=this[_0x52168e(0x1d9)][_0x52168e(0x1b5)](_0x52168e(0x1e1)),_0x5adda8=await _0x2a5139[_0x52168e(0x1bc)](_0x52168e(0x1da))[_0x52168e(0x1e0)]('signin.userId\x20=\x20:userId',{'userId':_0x2c4347['user']['id']})[_0x52168e(0x1e0)](_0x52168e(0x1db),{'firstDay':_0x34d37a})['andWhere'](_0x52168e(0x1e5),{'lastDay':_0x2515e7})[_0x52168e(0x1b9)](),_0x510c95=new Date(_0x34d37a),_0x3c8c75=new Date(_0x2515e7),_0x36838e=[],_0x1d175f=new Date(_0x510c95);while(_0x1d175f<=_0x3c8c75){_0x36838e[_0x52168e(0x1d8)]((0x0,date_1[_0x52168e(0x1e3)])(new Date(_0x1d175f))[_0x52168e(0x1ea)](_0x52168e(0x1d4))),_0x1d175f['setDate'](_0x1d175f[_0x52168e(0x1de)]()+0x1);}const _0x439880=[];for(const _0x7c75ed of _0x36838e){const _0x275071=_0x5adda8[_0x52168e(0x1eb)](_0xdbd278=>_0xdbd278[_0x52168e(0x1ed)]===_0x7c75ed);!_0x275071?_0x439880[_0x52168e(0x1d8)]({'signInDate':_0x7c75ed,'isSigned':![]}):(_0x275071[_0x52168e(0x1f3)]=!![],_0x439880[_0x52168e(0x1d8)](_0x275071));}return _0x439880;}catch(_0x12ece3){console[_0x52168e(0x1b7)](_0x52168e(0x1d0),_0x12ece3);throw new common_1['HttpException'](_0x52168e(0x1dc),common_1['HttpStatus'][_0x52168e(0x1f4)]);}}};SigninService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(signIn_entity_1[_0x4bbbee(0x1b6)])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(user_entity_1[_0x4bbbee(0x1e7)])),__metadata(_0x4bbbee(0x1d7),[typeorm_2[_0x4bbbee(0x1d5)],typeorm_2[_0x4bbbee(0x1d5)],userBalance_service_1[_0x4bbbee(0x1e9)],globalConfig_service_1[_0x4bbbee(0x1bb)]])],SigninService),exports['SigninService']=SigninService;